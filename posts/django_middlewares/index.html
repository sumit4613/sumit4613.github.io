<!DOCTYPE html>
<html lang="en">
  <head>
    

<title>Django Middlewares | Sumit Singh</title>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="description" content="We&rsquo;ll come to know about middlewares in django but first, let&rsquo;s understand what is a middleware.
What is a middleware? Middleware is a software that &hellip;" />
<meta property="og:description" content="We&rsquo;ll come to know about middlewares in django but first, let&rsquo;s understand what is a middleware.
What is a middleware? Middleware is a software that &hellip;" />
<meta property="og:site_name" content="Sumit Singh"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="Django Middlewares | Sumit Singh"/>
<meta property="og:url" content="https://sumit4613.github.io/posts/django_middlewares/"/>
<link rel="canonical" href="https://sumit4613.github.io/posts/django_middlewares/"/>
<link rel="me" href="https://fosstodon.org/@sumit4613"/>
<script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="0a3e961b-6860-4254-899b-ad117e2017dd"
        async></script>


<link rel='icon' type='image/png' href='https://sumit4613.github.io/images/avatar.3628534a52ffff44dc80bf8c695cf2d9cba2fc8e396883029bdcc92b8dbe55e4.jpg'/>

<link rel="stylesheet" href="https://sumit4613.github.io/styles/base.min.7a54543f62c87dca91739b5348c7e710a0b75a872743e8dec760805b465f2f00.css"/>

<script async defer src="https://sumit4613.github.io/scripts/base.min.f2fae3968444d1ab70411f2de4a824171ecadc6e3dee62dfc9652582e0b1142a.js"></script>


  </head>
  
  <body class="bg-neutral-000">
    <section class="max-w-6xl mx-auto p-4 relative min-h-screen">
      <div class="md:flex md:justify-center md:mt-48">
        <aside>
          
<nav class="flex justify-between w-full items-center md:block mb-12 md:mb-0" aria-label="navigation">
  <a class="flex justify-end md:w-full md:mb-12" href="/">
    
    <img class="rounded-full h-8 w-8 md:h-12 md:w-12" alt="A circular photo of Sumit; links to home." src="https://sumit4613.github.io/images/avatar.3628534a52ffff44dc80bf8c695cf2d9cba2fc8e396883029bdcc92b8dbe55e4.jpg" />
  </a>
  <div class="text-right md:-mt-1 md:opacity-50 transition-opacity hover:opacity-100 focus:opacity-100">
    <div class="md:text-right">
      <ul class="-ml-2 md:ml-0 flex md:block">
        
        <li>
          <div class="portal font-semibold ~critical  text-critical-500 ">
            <a href="/portfolio/">
              
              <span>Portfolio</span>
              
            </a>
          </div>
          <br>
        </li>
        
        <li>
          <div class="portal font-semibold ~warning  active ">
            <a href="/posts/">
              
              <span>Posts</span>
              
            </a>
          </div>
          <br>
        </li>
        
      </ul>
    </div>
  </div>
</nav>

        </aside>
        <div class="md:min-w-xl md:max-w-xl md:mx-16">
          
          
<section>
    <div>
        
            
            <h3 class="inline heading font-bold md:text-4xl">
                Django Middlewares
                
            </h3>
            <h3 class="inline heading font-bold md:text-4xl opacity-50">
                
            </h3>
            
    </div>
    <div class="mt-4">
        
        <span class="chip ~neutral !low -ml-2 mb-2">
            Nov 2, 2022
        </span>
        
        
        
        <a class="chip ~neutral !normal bg-neutral-100 mb-2 mr-2" href="https://sumit4613.github.io/tags/python/" aria-label="tagged under python">python</a>
        
        
        
        <a class="chip ~neutral !normal bg-neutral-100 mb-2 mr-2" href="https://sumit4613.github.io/tags/django/" aria-label="tagged under django">django</a>
        
        
    </div>
</section>


          <hr class="sep h-8">
          
<main>
  <section class="content">
    <p>We&rsquo;ll come to know about middlewares in django but first, let&rsquo;s understand what is a middleware.</p>
<h2 id="what-is-a-middleware">What is a middleware?</h2>
<p>Middleware is a software that acts as a bridge between an operating system and applications running on it. It provides
common services and capabilities to applications outside what&rsquo;s available from the operating system.</p>
<h2 id="what-is-a-django-middleware">What is a django middleware?</h2>
<ul>
<li>A middleware is a component that sits between the Django view and the Django template.</li>
<li>It is a framework that allows you to hook into Django&rsquo;s request/response processing at various points.</li>
<li>It&rsquo;s a lightweight, low-level, plug-in system for globally altering Django&rsquo;s input or output.</li>
<li>It can be used to modify the incoming request before it reaches the view, or the outgoing response before it reaches
the browser.</li>
<li>It can also be used to execute some code that doesn&rsquo;t fit neatly into any of your existing views or models.</li>
</ul>
<h2 id="how-middleware-works-in-django">How middleware works in django?</h2>
<ul>
<li>When a request comes to the server, it is first processed by the middleware.</li>
<li>The middleware then passes the request to the view.</li>
<li>The view processes the request and returns a response.</li>
<li>The middleware then processes the response and returns it to the browser.</li>
</ul>
<h2 id="ordering-and-layering-of-middlewares">Ordering and layering of middlewares</h2>
<ul>
<li>Django middlewares are executed in the order they are defined in the <code>MIDDLEWARE</code> setting.</li>
<li>The order of middlewares is important because each middleware can modify the request and response.</li>
<li>The order of middlewares is also important because some middlewares depend on the output of other middlewares. For
example, the <code>SessionMiddleware</code> depends on the <code>AuthenticationMiddleware</code> to populate the <code>request.user</code> attribute.</li>
<li>Middlewares are run in <strong>reverse order</strong> when the response is returned to the browser.</li>
<li>The <code>SecurityMiddleware</code> is the first middleware in the list of middlewares. It is the first middleware to process the
request and the last middleware to process the response.</li>
</ul>
<h2 id="how-to-write-a-custom-middleware-in-pre-django-110-style">How to write a custom middleware in pre-Django 1.10-style?</h2>
<ul>
<li>In pre-Django 1.10-style, we have to write a middleware class that implements the <code>process_request()</code> and
<code>process_response()</code> methods.</li>
<li>You need to inherit the <code>MiddlewareMixin</code> class to make sure that your middleware is compatible with both pre-Django
1.10-style and post-Django 1.10-style.</li>
<li>The <code>process_request()</code> method is called before the view is called.</li>
<li>The <code>process_response()</code> method is called after the view is called.</li>
<li>The <code>process_exception()</code> method is called if an exception occurs in the view. This method is optional.</li>
<li>The <code>process_template_response()</code> method is called after the view is called and the response is rendered. This method
is
optional.</li>
<li>The <code>process_view()</code> method is called just before Django calls the view.. This method is optional.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.utils.deprecation</span> <span class="kn">import</span> <span class="n">MiddlewareMixin</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyMiddleware</span><span class="p">(</span><span class="n">MiddlewareMixin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process_request() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process_response() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process_exception() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_template_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process_template_response() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="n">view_args</span><span class="p">,</span> <span class="n">view_kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process_view() is called&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="how-to-write-a-custom-middleware-as-a-function">How to write a custom middleware as a function?</h2>
<ul>
<li>In Django 1.10+, we can write a middleware as a function.</li>
<li>The function takes a <code>get_response</code> argument and returns a callable.</li>
<li>The function is called once when the server starts.</li>
<li>The callable is called for every request.</li>
<li>The callable must return a <code>HttpResponse</code> object.</li>
<li>The <code>get_response</code> argument is a callable that takes a request and returns a response.</li>
<li>The <code>get_response</code> argument is used to call the next middleware in the chain.</li>
<li>The <code>get_response</code> argument is used to call the view if the middleware is the last one in the chain.</li>
<li>The <code>get_response</code> argument is used to return the response if the middleware is the first one in the chain.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_middleware</span><span class="p">(</span><span class="n">get_response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;middleware() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Code to be executed for each request before</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># the view (and later middleware) are called.</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;middleware() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Code to be executed for each request/response after</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># the view is called.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">middleware</span>
</span></span></code></pre></div><h2 id="how-to-write-a-custom-middleware-as-a-class">How to write a custom middleware as a class?</h2>
<ul>
<li>In Django 1.10+, we can write a middleware as a class.</li>
<li>The <code>__init__()</code> method is called once when the server starts, and it takes a <code>get_response</code> argument.</li>
<li>The <code>__init__()</code> method must store the <code>get_response</code> argument as an instance attribute and not call it.</li>
<li>The class must implement the <code>__call__()</code> method.</li>
<li>The <code>__call__()</code> method is called for every request and must return a <code>HttpResponse</code> object.</li>
<li>The <code>__call__()</code> method must call the <code>get_response</code> argument and return the response.</li>
<li>The <code>__call__()</code> method can modify the request before calling the <code>get_response</code> argument and modify the response
before returning it.</li>
<li>The <code>__call__()</code> method can raise an exception to stop the request/response chain.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyMiddleware</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span> <span class="o">=</span> <span class="n">get_response</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;init() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;call() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Code to be executed for each request before</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># the view (and later middleware) are called.</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;call() is called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Code to be executed for each request/response after</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># the view is called.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></div><h2 id="a-real-world-example-of-a-custom-middleware">A real-world example of a custom middleware</h2>
<ul>
<li>In this example, we will write a middleware that will log the request and response.</li>
<li>The middleware will log the request and response only if the <code>DEBUG</code> setting is <code>True</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RequestResponseLoggingMiddleware</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_response</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span> <span class="o">=</span> <span class="n">get_response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Request: &#34;</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Response: &#34;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></div><p>So that&rsquo;s how you can write a custom middleware in Django. I hope you found this tutorial useful. Thanks for reading!</p>

  </section>
</main>


          <hr class="sep h-16">
          <footer>
            <footer class="family-secondary support content">
    <p class="pb-2">
        Hi! If you made it this far, maybe you want to stay in touch. You can follow me on <a
            href="https://twitter.com/sumitsingh4613">Twitter</a>, subscribe via <a href="/index.xml">Atom/RSS</a>.
    </p>
    <p class="pb-8">
        &copy; Sumit Singh 2023.
        Content is licensed <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>, a Free Culture
        License.
        The <a href="https://github.com/sumit4613/sumit4613.github.io">source code</a> is available under <a
            href="https://github.com/sumit4613/sumit4613.github.io/blob/master/LICENSE">GPLv3</a>.
        <i>If you see any issue or any typo please create an  <a href="https://github.com/sumit4613/sumit4613.github.io/issues">issue here.</a></i>
        <br>
        <br>
        <strong>This site's design is heavily inspired by <a href="https://miles.land/">Miles Land</a>. Due to its
            minimalistic design, it's a great starting point for a personal website.</strong>
    </p>
</footer>

          </footer>
        </div>
        <aside class="hidden pl-8 self-start sticky-top lg:block text-xs">
          
        </aside>
      </div>
    </section>
  </body>
  
</html>
